<!DOCTYPE html>
<html>
  <head>
    <title>WildFly administration</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }      
      .red { color: red; }
      .white { color: white; }
      .bold { font-weight: bold; }
      .pull-left {
        float: left;
        width: 47%;
      }
      .pull-right {
        float: right;
        width: 47%;
      }
      .pull-right ~ p {
        clear: both;
      }
      .font300 {
        font-size: 300%;
      }
      .font200 {
        font-size: 200%;
      }
      .remark-slide-number {
        bottom: 20px;
        right: 10px;
      }
    </style>
  </head>
  <body>
    <textarea id="source">

layout: true
background-image: url(wildfly_deck_base.jpg)

---
class: center, middle

# .font200[Messaging configuration]

## JBOSS1 - WildFly Administration

???
* book pg. 78
* https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/configuring_messaging/
* https://docs.jboss.org/author/display/WFLY/Messaging+configuration
---

## Messaging systems

* managing application messages
  * delivering them to recipients
* decouple senders and recipients
* Java EE
  * Java Messaging Service (JMS) - unified API

???
* Messaging systems decouple a message’s sender of messages from it consumer(s). In fact, the senders and consumers of messages are completely independent and know nothing of each other, which allows you to create flexible, loosely coupled systems. Large enterprises often use a messaging system to implement a message bus which loosely couples heterogeneous systems together. Message buses can form the core of an Enterprise Service Bus (ESB). Using a message bus to decouple disparate systems allows the system to grow and adapt more easily. It also allows more flexibility to add new systems or retire old ones since they don’t have brittle dependencies on each other.
* EE 7 - JMS 2.0, JSR 343 - https://jcp.org/en/jsr/detail?id=343

--

### Messaging styles & Destinations

* Point-to-Point
  * Queue
* Publish-Subscribe
  * Topic

???
* P2P - each message received by only one consumer
* P-S - message received by all subscribers
  * Another interesting distinction is that **subscribers can be durable**. Durable subscriptions pass the server a unique identifier when connecting, which allows the server to identify and send any messages published to the topic since the last time the subscriber made a connection. Such messages are typically retained by the server even after a restart.
  
## Destinations
JMS destinations, along with JMS connection factories, are JMS administrative objects. Destinations are used by JMS clients for both producing and consuming messages.

---
## JMS Queues and Topics

* durability can be enabled
  * messages then survive server restarts

### JBoss CLI
```bash
jms-topic add --topic-address=myTopic \
  --entries=[jms/topic/myTopic java:jboss/exported/jms/topic/myTopic]

jms-queue add --queue-address=myQueue \
  --entries=[jms/queue/myQueue java:jboss/exported/jms/queue/myQueue]
```

---
## Special queues

--

### Dead Letter Queue

* destination for messages with delivery problems
  * e.g. message reach max delivery attempts

???
* JBoss AS 5.1 sample http://middlewaremagic.com/jboss/?p=1227

--

### Expiry Queue

* destination for expired messages
  * expiry reaper thread examines periodically the messages

???
* https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.0/html-single/configuring_messaging/#set_message_expiry
You can specify where to send expired messages by setting an expiry address. If a message expires and no expiry address is specified, the message is removed from the queue and dropped.
--

### Last-value Queues
* able to discard message when a new come
  * when they have the same value of message property `_AMQ_LVQ_NAME`
* configured in Address settings

```xml
<address-setting name="jms.queue.lastValue" last-value-queue="true" />
```

---
## Address settings

* how and when are messages delivered
* redelivery and expiration options

???

What to do with messages sent to given address(es)

--

### Default config
```xml
<address-setting name="#"
  dead-letter-address="jms.queue.DLQ" expiry-address="jms.queue.ExpiryQueue"
  max-size-bytes="10485760" page-size-bytes="2097152"
  message-counter-history-day-limit="10"
  redistribution-delay="1000"/>
```
???
* default address setting

---
## Address name - Wildcard syntax

* `"#"` any sequence of zero or more words
* `"*"` a single word
* `"."` word separator

--

### Examples

* `wildfly.training.#` - Matches `wildfly.training`, `wildfly.training.brno`, `wildfly.training.lesson.messaging`
* `brno.*` - Matches `brno.training`, `brno.cz`, but not `brno.training.wildfly`
* `jms.*.myDest` - Matches `jms.queue.myDest`, `jms.topic.myDest`

---
## Messaging security

### Destinations and Role Based Access Control

* by default the `messaging-activemq` subsystem uses the `"other"` security domain in `security` subsystem
  * references application security realm: `ApplicationRealm`
  * use `./add-user.sh` script to create users with required roles

--

```adoc
[standalone@localhost:9990 /] /subsystem=messaging-activemq/server=default/security-setting=#:read-resource(recursive=true)
{
    "outcome" => "success",
    "result" => {"role" => {"guest" => {
        "consume" => true,
        "create-durable-queue" => false,
        "create-non-durable-queue" => true,
        "delete-durable-queue" => false,
        "delete-non-durable-queue" => true,
        "manage" => false,
        "send" => true
    }}}
}
```
---
## Security - Permissions
* `create-durable-queue`
* `delete-durable-queue`
* `create-non-durable-queue`
* `delete-non-durable-queue`
* `send`
* `consume`
* `manage`
  - invoke management operations

*Permission grants are based on matching address and role name.*

???
- invoke management operations by sending management messages to the management address

---
class: center, middle

# Questions?

    </textarea>
    <script src="../remark-0.13.min.js">
    </script>
    <script>
      var slideshow = remark.create({
        ratio: '16:10',
        highlightStyle: 'monokai',
        highlightLanguage: 'remark',
        highlightLines: true,        
        countIncrementalSlides: false
      });
    </script>
  </body>
</html>
